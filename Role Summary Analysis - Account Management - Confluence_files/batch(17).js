WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:loader', location = 'loader.chunk.js' */
(window.atlassianWebpackJsonp77bd9c8b87e6dc89db026400e110f339=window.atlassianWebpackJsonp77bd9c8b87e6dc89db026400e110f339||[]).push([["loader"],{"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/common/common.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,'.ic-sidebar .ic-sidebar-heading{background-color:var(--ds-surface,#fff);height:16px;margin:10px 17px 0;position:relative}.ic-sidebar .ic-sidebar-heading .ic-right-toolbar{float:right;margin-right:-3px;margin-top:-4px}.ic-sidebar .ic-sidebar-heading .ic-right-toolbar a.ic-action-menu{margin-right:5px}.ic-sidebar .ic-sidebar-heading .ic-right-toolbar a.ic-action-menu span{color:var(--ds-text-subtle,#707070)}.ic-sidebar .ic-sidebar-heading .ic-right-toolbar .ic-action-hide{float:right;margin-left:5px;margin-top:4px}.ic-sidebar .ic-sidebar-heading .aui-button.aui-button-text,.ic-sidebar .ic-sidebar-heading .aui-button.aui-button-text:visited{color:var(--aui-button-default-text-color,#3572b0)}.ic-sidebar .ic-sidebar-heading .aui-button.aui-button-text:active,.ic-sidebar .ic-sidebar-heading .aui-button.aui-button-text:focus,.ic-sidebar .ic-sidebar-heading .aui-button.aui-button-text:hover{text-decoration:none}.ic-sidebar .ic-sidebar-heading .aui-button.aui-button-text[aria-disabled=true],.ic-sidebar .ic-sidebar-heading .aui-button.aui-button-text[disabled]{color:var(--aui-button-default-disabled-text-color)}.ic-sidebar .ic-list{background:var(--ds-surface,#fff)}.ic-sidebar .aui-dropdown2 a{color:var(--confluence-color-scheme-menuItemTextColor,var(--ds-text))}.ic-sidebar .aui-dropdown2 a.active:not(.aui-dropdown2-disabled),.ic-sidebar .aui-dropdown2 a:not(.aui-dropdown2-disabled):focus,.ic-sidebar .aui-dropdown2 a:not(.aui-dropdown2-disabled):hover{background-color:var(\n            --confluence-color-scheme-menuItemSelectedBackgroundColor,var(--ds-background-neutral-hovered)\n        );color:var(--confluence-color-scheme-menuItemSelectedTextColor,var(--ds-text))}.ic-comment-container{background-color:var(--ds-surface,#fff);border-bottom:1px solid var(--ds-border,#ccc);border-left:1px solid var(--ds-border,#ccc);border-top:1px solid var(--ds-border,#ccc)}.ic-comment-container.ic-deleted,.ic-comment-container.ic-resolved{border-left:1px solid var(--ds-border,#ccc);padding-left:3px}.ic-author{grid-gap:10px;align-items:center;display:flex;gap:10px}.ic-author .url{color:var(--ds-text,#707070);font-weight:700;max-width:212px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ic-author .ic-date .comment-date{color:var(--ds-text-subtle,#6b778c);font-size:12px}.ic-author .ic-date .comment-permalink{height:auto;line-height:normal;padding:0}.ic-actions{line-height:16px;margin-top:10px}.ic-actions .aui-button{font-size:12px;height:16px}.ic-actions ul{display:inline;padding:0;width:100%}.ic-actions ul li{display:inline-block;list-style-type:none}.ic-actions ul li:last-child:after{display:none}.ic-actions ul li:after{color:var(--ds-text-subtle,#707070);content:"â€¢";font-size:12px;padding:0 3px}.ic-actions .aui-button.aui-button-link{border:none;color:var(--ds-text-subtle,#707070);padding:0}',""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/confirm-dialog/confirm-dialog.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,".ic-confirm-label{color:var(--ds-text-subtle,#707070);text-transform:uppercase}.ic-confirm-message{color:var(--ds-text-subtle,#707070);padding-bottom:5px}.ic-confirm-container{background-color:var(--ds-surface,#fff);border:1px solid var(--ds-border,#ccc);box-shadow:0 3px 6px var(--ds-shadow-overflow,#0003);font-weight:400;max-width:150px;overflow-y:auto;padding:20px;position:absolute;right:18px;text-transform:none;top:18px;z-index:1}.ic-action-menu.ic-action-menu-active{background-color:var(--ds-background-input-pressed,#f2f2f2);background-image:none;border-color:var(--ds-border-accent-gray,#ccc);box-shadow:inset 0 3px 6px var(--ds-shadow-raised,#0000001a);text-decoration:none;text-shadow:none}",""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/create-comment/create-comment.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,".ic-create-comment-view .ic-create-comment{margin:10px 18px}.ic-create-comment-view .ic-create-comment .ic-date{display:none}.ic-create-comment-view .ic-body{margin:5px 0 0}.ic-create-comment-view .ic-body .loading-container{height:20px}.ic-create-comment-view .ic-body #anonymous-warning{margin-bottom:10px}.ic-create-comment-view .aui-button-link.ic-action-save{font-size:12px;line-height:20px}.ic-create-comment-view .textarea.ic-textarea{height:80px}.ic-create-comment-view #rte-savebar{background-color:initial;border:0;box-shadow:none;padding:5px 0 0}.ic-create-comment-view #rte-savebar .save-button-container{margin-right:0}.ic-create-comment-view #rte-savebar #rte-button-cancel{margin-left:10px}.ic-create-comment-view #rte-savebar #rte-savebar-tinymce-plugin-point,.ic-create-comment-view #rte-savebar .toolbar-group-edit,.ic-create-comment-view #rte-savebar .toolbar-group-preview{display:none}.ic-create-comment-view #rte-spinner{margin-top:6px}.ic-create-comment-view #wysiwyg{border:1px solid var(--ds-border,#ccc);border-radius:3px;box-shadow:inset -1px 1px 5px var(--ds-shadow-overflow,#f5f5f5)}.ic-create-comment-view #rte{background-color:var(--ds-surface,#fff);box-shadow:inset 0 1px 3px var(--ds-shadow-overlay,#ccc);padding:8px}.ic-display-comment .ic-create-comment-view,.ic-replies .ic-create-comment-view,.ic-reply-container .ic-create-comment-view{border:none}.ic-display-comment .ic-create-comment,.ic-replies .ic-create-comment,.ic-reply-container .ic-create-comment{margin-bottom:0;margin-left:0;margin-right:0}.ic-create-comment-view #editor-notifications-container{display:none}",""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/display-comment/display-comment.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,'.ic-display-comment-view .ic-display-comment{margin:10px 18px}.ic-display-comment-view .ic-display-comment:hover .comment-permalink{opacity:1}.ic-display-comment-view .ic-body{margin:5px 0 0}.ic-display-comment-view .ic-comment-container .ic-unresolved-message{border-top:1px solid var(--ds-border,#ccc);font-size:12px;padding:5px 18px 5px 16px}.ic-display-comment-view .ic-comment-container .ic-actions{margin-bottom:10px}.ic-content{word-wrap:break-word;overflow-x:hidden}.ic-content pre{overflow-x:auto}.ic-body>.ic-content>p{word-wrap:break-word;white-space:pre-wrap}#ic-menu-items{max-width:160px;min-width:100px}.ic-container .ic-action-resolve .ic-unresolved{color:var(--ds-icon-subtle,#f5f5f5)}.ic-container .ic-action-resolve .ic-resolved{color:var(--ds-icon-success,#14892c)}.ic-display-comment-view .resolved{background-color:var(--ds-surface,#fff);position:relative}.ic-display-comment-view .resolved .ic-container{opacity:.2}.ic-page-comment,.ic-resolved-mask{padding-bottom:20px;text-align:center;width:100%}.ic-page-comment .ic-page-comment-content,.ic-page-comment .ic-resolved-mask-content,.ic-resolved-mask .ic-page-comment-content,.ic-resolved-mask .ic-resolved-mask-content{margin:32px auto 20px}.ic-page-comment .ic-page-comment-content .line,.ic-page-comment .ic-resolved-mask-content .line,.ic-resolved-mask .ic-page-comment-content .line,.ic-resolved-mask .ic-resolved-mask-content .line{display:block}.ic-page-comment .ic-page-comment-content .aui-iconfont-success,.ic-page-comment .ic-resolved-mask-content .aui-iconfont-success,.ic-resolved-mask .ic-page-comment-content .aui-iconfont-success,.ic-resolved-mask .ic-resolved-mask-content .aui-iconfont-success{color:var(--ds-icon-success,#14892c);margin:0 auto 5px}.ic-page-comment .ic-page-comment-message-container,.ic-page-comment .resolved-message-container,.ic-resolved-mask .ic-page-comment-message-container,.ic-resolved-mask .resolved-message-container{margin:10px 18px 0 16px}.ic-page-comment .ic-page-comment-message-container .ic-page-comment-message-sideline,.ic-page-comment .ic-page-comment-message-container .resolved-message-sideline,.ic-page-comment .resolved-message-container .ic-page-comment-message-sideline,.ic-page-comment .resolved-message-container .resolved-message-sideline,.ic-resolved-mask .ic-page-comment-message-container .ic-page-comment-message-sideline,.ic-resolved-mask .ic-page-comment-message-container .resolved-message-sideline,.ic-resolved-mask .resolved-message-container .ic-page-comment-message-sideline,.ic-resolved-mask .resolved-message-container .resolved-message-sideline{text-align:center}.ic-page-comment .ic-page-comment-message-container .ic-page-comment-message-sideline .resolved-menu-name,.ic-page-comment .ic-page-comment-message-container .resolved-message-sideline .resolved-menu-name,.ic-page-comment .resolved-message-container .ic-page-comment-message-sideline .resolved-menu-name,.ic-page-comment .resolved-message-container .resolved-message-sideline .resolved-menu-name,.ic-resolved-mask .ic-page-comment-message-container .ic-page-comment-message-sideline .resolved-menu-name,.ic-resolved-mask .ic-page-comment-message-container .resolved-message-sideline .resolved-menu-name,.ic-resolved-mask .resolved-message-container .ic-page-comment-message-sideline .resolved-menu-name,.ic-resolved-mask .resolved-message-container .resolved-message-sideline .resolved-menu-name{font-weight:700}.ic-delete-comment-view{margin-bottom:50px;margin-top:50px;text-align:center}.ic-delete-comment-view .ic-delete-image{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAA2klEQVR4Xu2XQQrCMBBFeyN7Gj1FSHK5nsl6BLvQBBqQR2mcSQKC8+AvdJw3H+3GaTL+Ae/9LYRwjzG+jpJn+TPcG8ZZmc9S3BtGOcr3C7V5d2oHa3MVSXj95qeRRv18jShTonq+KOkd3qtCQe/wXhUKeof3jG7wq24N/WIobA39YihsDf1iKGwN/WIoTNk4O3m9cb/M1FBohQiFVohQaIUIhVaIUGiFCIW/UGiltCEr/WLSX5blQKxKdtEvJknmlCfl0mSHc+5Cv4q91JLy4KFa8s6+O9NraHgDIjRDQD3hAXgAAAAASUVORK5CYII=");display:block;height:36px;margin:0 auto 5px;width:36px}li.ic-action-like-reply:before,li.ic-action-like:before{display:none}.ic-actions a.ic-date-link{color:var(--ds-text-subtle,#707070);cursor:pointer;font-size:12px}.ic-actions a.ic-date-nolink{--aui-link-hover-decoration:none;color:var(--ds-text-subtle,#707070);cursor:text;font-size:12px}.ic-comment-reply-highlight{background:var(--ds-background-selected,#deebff)}',""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/display-reply/display-reply.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,".ic-replies{border-bottom:1px solid var(--ds-border,#ccc);border-left:1px solid var(--ds-border,#ccc)}.ic-replies .ic-body{margin:5px 0 0}.ic-replies #ic-showmore-container{border-bottom:1px solid var(--ds-border,#ccc);height:29px}.ic-replies #ic-showmore-container .ic-decor-line{border-bottom:1px solid var(--ds-border,#ccc);height:9px}.ic-replies #ic-showmore-container .ic-collapse-decor-center{position:relative;text-align:center}.ic-replies #ic-showmore-container .ic-collapse-decor-center span{background-color:var(--ds-surface,#f5f5f5);cursor:pointer;padding:0 5px;position:relative;top:-16px}.ic-replies:empty{border-bottom:none}.ic-display-reply,.ic-reply-container{padding:10px 18px}.ic-display-reply.focused,.ic-reply-container.focused{border-left:4px solid var(--ds-border-brand,#3b73af)}.ic-display-reply:not(:last-child){border-bottom:1px solid var(--ds-border,#ccc)}.ic-display-reply:hover .comment-permalink{opacity:1}.ic-reply-container{background-color:var(--ds-surface,#fff);border-bottom:1px solid var(--ds-border,#ccc);border-left:1px solid var(--ds-border,#ccc)}.ic-reply-container .ic-author{font-weight:400;line-height:16px}.ic-reply-container .ic-author .aui-avatar-inner{height:16px;width:16px}.ic-create-comment-view+.ic-reply-placeholder,.ic-reply-container .ic-date,.ic-reply-container:empty{display:none}.ic-reply-placeholder textarea.textarea.ic-textarea{height:30px;resize:none}.ic-reply-placeholder textarea.textarea.ic-textarea::placeholder{color:var(--ds-text-subtle,#707070)}",""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/likes/likes.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,".ic-likes{display:inline-block}.ic-like-summary{color:var(--ds-text-subtle,#707070)}.ic-like-summary .aui-iconfont-like{margin:0 2px}.ic-likes-count{cursor:pointer;font-size:12px}",""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/navigation/navigation.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,"#ic-nav-container{color:var(--ds-text-subtle,#707070);display:inline-block}#ic-nav-container #ic-nav-previous{margin-left:3px}#ic-nav-container #ic-nav-next span,#ic-nav-container #ic-nav-previous span{margin-top:-2px}#ic-nav-container .ic-nav-x-out-of-y{font-size:12px;padding-left:10px;vertical-align:text-top}",""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/resolved-comment/resolved-comment.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,"#ic-resolved-comment-dialog{padding:0 20px}#ic-resolved-comment-dialog .ic-display-comment-view:last-child{border-bottom:none}#ic-resolved-comment-dialog .ic-display-comment-view{border-bottom:1px solid var(--ds-border,#ccc);padding:20px 0}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment{margin:0;padding-left:20px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-author{padding-top:0}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-author .url{max-width:460px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-author-avatar{margin:0 8px 0 0}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-body{margin:20px 0 12px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-body .ic-content blockquote{border-left:1px solid var(--ds-border,#ccc);margin-left:0}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-body .ic-content blockquote .ic-resolved-marker{background-color:var(--ds-background-accent-yellow-subtler,#fff0b3);border-bottom:2px solid var(--ds-border-accent-yellow,#ffc400d1);color:var(--ds-text-subtle,#707070);line-height:1.6;padding:2px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-body .ic-content blockquote .ic-body-comment{margin-top:18px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-actions{font-size:12px;margin-top:6px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-actions .ic-action-show-reply{color:var(--ds-link,#3b73af)}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-actions ul li:not(.hidden):nth-child(3) .ic-date-link span{width:345px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-actions ul li:nth-child(2) .ic-date-link span{width:400px}#ic-resolved-comment-dialog .ic-display-comment-view .focused{border-left:5px solid var(--ds-border-brand,#3b73af)}#ic-resolved-comment-dialog .ic-display-comment-view .aui-button{line-height:normal;outline:none}#ic-resolved-comment-dialog .ic-display-comment-view .ic-resolved-message{color:var(--ds-text-subtle,#707070);font-size:12px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-resolved-message .aui-iconfont-success{color:var(--ds-icon-success,#14892c);margin-left:4px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-resolved-message .ic-date-link span{display:inline-block;height:20px;overflow:hidden;text-overflow:ellipsis;vertical-align:middle;white-space:nowrap;width:360px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-replies{background:var(--ds-background-accent-gray-subtlest,#f4f5f7);border:none;margin-top:15px;padding:10px 0}#ic-resolved-comment-dialog .ic-display-comment-view .ic-replies .ic-display-reply{padding-left:20px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-replies .ic-display-reply .ic-date-link{color:var(--ds-text-subtle,#707070);cursor:pointer;font-size:12px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-replies .ic-reply-content{max-width:none}#ic-resolved-comment-dialog .ic-display-comment-view .ic-replies .ic-author .url{max-width:440px}#ic-resolved-comment-dialog .aui-message{margin-bottom:10px}#ic-resolved-comment-dialog #ic-resolved-comment-dialog-error .aui-message{margin:20px 0 0}#inline-dialog-ic-resolved-dialog-discovery{border:2px solid var(--ds-border-accent-orange,#f79232);border-radius:5px}#inline-dialog-ic-resolved-dialog-discovery .contents{border:none;padding:16px}",""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/sidebar/sidebar.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,"#rte-savebar{background-color:var(--ds-surface,#fff)}.ic-sidebar{clear:both;position:absolute;right:0;top:0;width:280px}.ic-sidebar>div{max-width:280px;width:280px}.ic-error>.aui-message{margin:10px}.ic-slide-in{animation:ic-slide-in .5s 1}@keyframes ic-slide-in{0%{right:-280px}to{right:0}}.ic-slide-out{animation:ic-slide-out .51s 1}@keyframes ic-slide-out{0%{right:0}to{right:-280px}}.ic-highlight-pulse{animation:ic-highlight-pulse .5s 1}.ic-fade-out-animation{animation:ic-fade-out-animation .5s 1}.ic-fade-in-animation{animation:ic-fade-in-animation .8s 1}",""]),t.a=s},"./src/main/frontend/loader/loader.ts":function(e,t,i){"use strict";i.r(t);var n=i("./node_modules/@atlassian/wrm-react-i18n/wrm-react-i18n.js"),s=i("confluence.web.resources:jquery/require('backbone')"),o=i.n(s),a=i("com.atlassian.confluence.plugins.confluence-inline-comments:util-resource/require('confluence/ic/util/text-highlighter')"),r=i.n(a),c=i("confluence.web.components:confluence/require('confluence/root')"),l=i.n(c),d=i("confluence.web.resources:jquery/require('jquery')"),m=i.n(d),u=i("./src/main/frontend/utils/utils.ts"),h=i("confluence.web.resources:underscore/require('underscore')"),p=i.n(h);var g={init:function(e){this.likesCache=p.a.clone(e)||{}},getLikes:function(e){if(this.likesCache&&this.likesCache[e]){return p.a.map(this.likesCache[e].likes,(function(e){return{username:e.user.name}}))}return null},add:function(e,t){this.likesCache[e]||(this.likesCache[e]={likes:[]}),this.likesCache[e].likes.push({user:{name:t}})},remove:function(e,t){if(this.likesCache[e]&&this.likesCache[e].likes){const i=p.a.reject(this.likesCache[e].likes,(function(e){return e.user.name===t}));this.likesCache[e].likes=i}},isLikable:function(){return void 0!==this.likesCache}},v=i("confluence.web.resources:ajs/require('ajs')"),f=i.n(v),b=i("confluence.web.resources:event/require('confluence/api/event')"),y=i.n(b),w=i("confluence.web.resources:view-comment/require('confluence/comments')"),x=i("com.atlassian.confluence.plugins.confluence-super-batch:react/require('react')"),k=i.n(x),E=i("com.atlassian.confluence.plugins.confluence-super-batch:react-dom-server/require('react-dom/server')"),C=i.n(E),T=i("confluence.web.resources:constants/require('confluence/api/constants')"),O=i("com.atlassian.confluence.plugins.confluence-frontend:date-time/require('confluence/date-time')"),j=i.n(O),I=i("./src/main/frontend/view/AUI/index.ts"),N=i("./src/main/frontend/view/AUI/Avatar.tsx");const _=({disabled:e,showIndex:t,index:i,size:s,isViewMode:o=!0,isMacOS:a=!1})=>{const r=o?"aui-button-text view-mode":"aui-button-text edit-mode",c=o?"Next comment (N)":a?"Next comment (\u2318+\u21e7+O)":"Previous comment (Ctrl+Shift+L)",l=o?"Previous comment (P)":a?"Previous comment (\u2318+\u21e7+L)":"Previous comment (Ctrl+Shift+L)";return k.a.createElement(k.a.Fragment,null,k.a.createElement(I.a,{type:"text",id:"ic-nav-next",extraClasses:r,iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-down",text:"",isDisabled:e,extraAttributes:{tabIndex:e?"":0,title:c,"aria-label":c}}),k.a.createElement(I.a,{type:"text",id:"ic-nav-previous",extraClasses:r,iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-up",text:"",isDisabled:e,extraAttributes:{tabIndex:e?"":0,title:l,"aria-label":l}}),t&&k.a.createElement("span",{className:"ic-nav-x-out-of-y"},n.format("{0} of {1}",i,s)))};var D=i("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),R=i.n(D),V=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/common/common.scss"),S={insert:"head",singleton:!1};R()(V.a,S),V.a.locals;const L=f.a.Confluence.Templates.User.usernameLink,A=({authorUserName:e,authorAvatarUrl:t,size:i})=>""===e?k.a.createElement(N.a,{size:i,avatarImageUrl:t,extraClasses:"ic-author-avatar",accessibilityText:" "}):k.a.createElement("a",{"data-username":e,href:`${T.CONTEXT_PATH}/display/~${e}`,title:"","data-user-hover-bound":"true",tabIndex:-1,role:"presentation","aria-hidden":"true"},k.a.createElement(N.a,{size:i,avatarImageUrl:t,extraClasses:"ic-author-avatar",accessibilityText:" "})),M=({showMenu:e,hasDeletePermission:t,hasEditPermission:i,hasResolvePermission:s,hasReplyPermission:o,createComment:a,darkFeatures:r,isViewMode:c,isMacOS:l})=>{const d=c?"ic-action-hide view-mode":"ic-action-hide edit-mode",m=c?"Close sidebar (])":l?"Close sidebar (\u2318+\u21e7+Z)":"Close sidebar (Ctrl+Shift+Z)";return k.a.createElement(k.a.Fragment,null,k.a.createElement("div",{className:"ic-sidebar-heading"},k.a.createElement("div",{id:"ic-nav-container"},a&&k.a.createElement(_,{disabled:!0,showIndex:!1,isViewMode:c,isMacOS:l})),k.a.createElement("div",{className:"ic-right-toolbar"},e&&k.a.createElement(B,{hasDeletePermission:t,hasEditPermission:i,hasResolvePermission:s,hasReplyPermission:o,darkFeatures:r}),k.a.createElement(I.a,{type:"text",extraClasses:d,iconClass:"aui-icon-small aui-iconfont-close-dialog",text:"",extraAttributes:{title:m,"aria-label":m}}))),k.a.createElement("div",{className:"ic-error"}))},P=({authorDisplayName:e,authorUserName:t,authorAvatarUrl:i,lastModificationDate:n,commentDateUrl:s})=>k.a.createElement(k.a.Fragment,null,k.a.createElement("div",{className:"ic-author"},k.a.createElement(A,{authorUserName:t,authorAvatarUrl:i,size:"medium"}),k.a.createElement("div",null,k.a.createElement("div",{dangerouslySetInnerHTML:{__html:L({canView:""!==t,username:t,fullName:e}).toString()}}),k.a.createElement("div",{className:"ic-date"},k.a.createElement($,{time:n,commentUrl:s,displayLink:!Object(u.B)()}))))),$=({time:e,commentUrl:t,displayLink:i})=>k.a.createElement(k.a.Fragment,null,k.a.createElement("span",{className:"comment-header-metadata"},k.a.createElement("span",{className:"comment-date",title:e&&"string"!=typeof e?j.a.formatDateTime(e):""},e?"string"==typeof e?e+" ":j.a.timeAgo(e)+" ":""),i&&k.a.createElement("button",{className:"aui-button aui-button-subtle aui-button-compact comment-permalink",type:"button","data-href":""+(t||""),"aria-label":"Copy link to comment",title:"Copy link to comment"},k.a.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-link","aria-hidden":"true"}),k.a.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-approve",role:"img","aria-label":"{getText('comment.permalink.description.copied')}"})))),U=({id:e,body:t,authorDisplayName:i,authorUserName:s,authorAvatarUrl:o,currentAuthorDisplayName:a,currentAuthorUserName:r,currentAuthorAvatarUrl:c,hasDeletePermission:l,hasResolvePermission:d,hasEditPermission:m,hasReplyPermission:h,showMenu:p,resolveProperties:g,lastModificationDate:v,commentDateUrl:f,darkFeatures:b})=>k.a.createElement(k.a.Fragment,null,k.a.createElement("div",{className:"ic-comment-container"},k.a.createElement(M,{hasDeletePermission:l,hasResolvePermission:d,hasEditPermission:m,hasReplyPermission:h,showMenu:!(!p||g.resolved),darkFeatures:b,createComment:!Object(u.B)(),isViewMode:!Object(u.B)(),isMacOS:Object(u.D)()}),g.resolved?k.a.createElement(X,{displayShowMeLink:!Object(u.B)()}):k.a.createElement(Y,{id:e,body:t,authorDisplayName:i,authorUserName:s,authorAvatarUrl:o,hasResolvePermission:d,resolveProperties:g,hasDeletePermission:l,lastModificationDate:v,commentDateUrl:f,darkFeatures:b})),!g.resolved&&k.a.createElement(k.a.Fragment,null,k.a.createElement("div",{className:"ic-list"}),k.a.createElement("div",{className:"ic-reply-container"},b.INLINE_COMMENTS&&h&&k.a.createElement("div",{className:"ic-reply-placeholder"},k.a.createElement(P,{authorUserName:r,authorAvatarUrl:c,authorDisplayName:a,lastModificationDate:v,commentDateUrl:f}),k.a.createElement("div",{className:"ic-body"},k.a.createElement("form",{className:"aui"},k.a.createElement("textarea",{className:"textarea ic-textarea",name:"body",placeholder:"Reply"}))))))),F=()=>k.a.createElement("div",{className:"ic-comment-container ic-deleted"},k.a.createElement(M,{createComment:!1,showMenu:!1,isViewMode:!Object(u.B)(),isMacOS:Object(u.D)()}),k.a.createElement("div",{className:"ic-delete-comment-view"},k.a.createElement("h2",null,k.a.createElement("span",{className:"aui-icon ic-delete-image line"},"::before"),"Deleted"))),B=({hasDeletePermission:e,hasResolvePermission:t,hasEditPermission:i,hasReplyPermission:s,darkFeatures:o})=>{const a=k.a.createElement("ul",{className:"aui-list-truncate"},t&&(null==o?void 0:o.RESOLVED_INLINE_COMMENTS)&&k.a.createElement("li",{className:"ic-action-resolve"},k.a.createElement("a",{href:"#"},"Resolve")),s&&k.a.createElement("li",{className:"ic-action-reply"},k.a.createElement("a",{href:"#"},"Reply")),i&&k.a.createElement("li",{className:"ic-action-edit"},k.a.createElement("a",{href:"#"},"Edit")),e&&k.a.createElement("li",{className:"ic-action-delete"},k.a.createElement("a",{href:"#"},"Delete")));return k.a.createElement(k.a.Fragment,null,(null==o?void 0:o.INLINE_COMMENTS)&&(e||s||t&&(null==o?void 0:o.RESOLVED_INLINE_COMMENTS))&&k.a.createElement(k.a.Fragment,null,k.a.createElement(I.a,{type:"subtle",extraClasses:"aui-button-compact aui-dropdown2-trigger-arrowless aui-style-default ic-action-menu",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-more",text:"",dropdown2Target:"ic-menu-items",extraAttributes:{"aria-label":"More options"}}),k.a.createElement(I.c,{id:"ic-menu-items",extraClasses:"aui-style-default"},a)))},q=({commentId:e})=>k.a.createElement("div",{className:"ic-comment-container"},k.a.createElement(M,{createComment:!1,showMenu:!1,isViewMode:!Object(u.B)(),isMacOS:Object(u.D)()}),k.a.createElement("div",{className:"ic-page-comment-view"},k.a.createElement("div",{className:"ic-page-comment"},k.a.createElement("div",{className:"ic-page-comment-content"},k.a.createElement("h2",{className:"ic-resolved-icon"},k.a.createElement(I.d,{useIconFont:!0,size:"large",icon:"success",extraClasses:"line"}),"Saved")),k.a.createElement("div",{className:"ic-page-comment-message-container"},k.a.createElement("div",{className:"ic-page-comment-message-sideline"},k.a.createElement("p",null,"Your comment has been saved as a page comment."),k.a.createElement("button",{id:"show-page-comment",className:"aui-button aui-button-link","data-comment-id":e},"Show me")))))),z=({hasResolvePermission:e,hasDeletePermission:t,darkFeatures:i})=>k.a.createElement(k.a.Fragment,null,(null==i?void 0:i.INLINE_COMMENTS)&&k.a.createElement("div",{className:"ic-actions"},k.a.createElement("ul",{className:"aui-list-truncate"},e&&(null==i?void 0:i.RESOLVED_INLINE_COMMENTS)&&k.a.createElement("li",null,k.a.createElement(I.a,{text:"Resolve",type:"link",extraClasses:"ic-action-resolve"})),t&&Object(u.B)()&&k.a.createElement("li",null,k.a.createElement(I.a,{text:"Delete",type:"link",extraClasses:"ic-action-delete"})),k.a.createElement("li",{className:"ic-action-like"})))),H=({hasResolvePermission:e,isDangling:t,resolveProperties:i,darkFeatures:s})=>k.a.createElement(k.a.Fragment,null,(null==s?void 0:s.INLINE_COMMENTS)&&k.a.createElement("div",{className:"ic-actions"},k.a.createElement("ul",{className:"aui-list-truncate"},e&&!t&&k.a.createElement("li",null,k.a.createElement(I.a,{type:"link",extraClasses:"ic-action-unresolve",text:"Reopen"})),k.a.createElement("li",{className:"hidden"},k.a.createElement(I.a,{type:"link",extraClasses:"ic-action-show-reply"})),(null==i?void 0:i.resolvedTime)>0&&k.a.createElement("li",{className:"ic-resolved-message"},k.a.createElement(I.d,{useIconFont:!0,size:"small",icon:"success"})," ")))),Y=({id:e,body:t,authorDisplayName:i,authorUserName:s,authorAvatarUrl:o,resolveProperties:a,lastModificationDate:r,commentDateUrl:c,darkFeatures:l,hasResolvePermission:d,hasDeletePermission:m,isDangling:u,originalSelection:h})=>{const p=()=>{const e=`${null!=a&&a.resolved?`<blockquote>\n                    <span class="ic-resolved-marker">${h||""}</span>\n                </blockquote>`:""}${t}`;return k.a.createElement("div",{className:"ic-content",dangerouslySetInnerHTML:{__html:e}})};return k.a.createElement(k.a.Fragment,null,k.a.createElement("div",{"data-comment-id":e,className:"ic-container ic-display-comment"},k.a.createElement(P,{authorUserName:s,authorAvatarUrl:o,authorDisplayName:i,commentDateUrl:c,lastModificationDate:null!=a&&a.resolved||null!=a&&a.resolvedByDangling?u&&null!=a&&a.resolvedByDangling?n.format("Resolved because the text was deleted by {0} {1}",null==a?void 0:a.resolvedUser,null==a?void 0:a.resolvedFriendlyDate):n.format("Resolved by {0} {1}",null==a?void 0:a.resolvedUser,null==a?void 0:a.resolvedFriendlyDate):r}),k.a.createElement("div",{className:"ic-body wiki-content"},k.a.createElement(p,null)),null!=a&&a.resolved?k.a.createElement(H,{hasResolvePermission:d,isDangling:u,resolveProperties:a,commentDateUrl:c,darkFeatures:l}):k.a.createElement(z,{hasResolvePermission:d,hasDeletePermission:m,darkFeatures:l})),!(null!=a&&a.resolved)&&(null==a?void 0:a.resolvedTime)>0&&(null==a?void 0:a.resolvedUser)&&k.a.createElement("div",{className:"ic-unresolved-message"},n.format("Reopened by {0} {1}",null==a?void 0:a.resolvedUser,null==a?void 0:a.resolvedFriendlyDate)))},X=({displayShowMeLink:e})=>k.a.createElement("div",{className:"ic-resolved-mask"},k.a.createElement("div",{className:"ic-resolved-mask-content"},k.a.createElement("h2",{className:"ic-resolved-icon"},k.a.createElement(I.d,{useIconFont:!0,size:"large",icon:"success",extraClasses:"line"}),"Resolved")),k.a.createElement("div",{className:"resolved-message-container"},k.a.createElement("div",{className:"resolved-message-sideline"},e?k.a.createElement("p",null,"You can see resolved comments at any time."):k.a.createElement(k.a.Fragment,null,k.a.createElement("p",null,k.a.createElement("span",null,"To reopen resolved comments, close the editor and select")," ",k.a.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-more"})," ",k.a.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-arrow-right"})," ",k.a.createElement("span",{className:"resolved-menu-name"},"Resolved comments"))),e&&k.a.createElement(I.a,{text:"Show me",type:"link",id:"show-resolved-comments"}))));var Q=i("confluence.web.resources:meta/require('confluence/meta')"),J=i.n(Q);var K=o.a.Model.extend({initialize:function(e){if(!e)throw new Error("Attributes is required");if(!e.username)throw new Error("username is a required attribute")}});var G=o.a.Collection.extend({model:K,url:function(){return`${T.CONTEXT_PATH}/rest/likes/1.0/content/${this.contentId}/likes`},initialize:function(e,t){if(p.a.bindAll(this,"_handleSaveSuccess","_handleDestroySuccess","_handleError"),void 0===(t=t||{}).contentId)throw new Error("content ID is required.");this.contentId=t.contentId,g.getLikes(t.contentId)&&this.reset(g.getLikes(t.contentId)),this.listenTo(o.a,"ic:likes-received",this.updateLikes),this.bind("add",e=>{e.save(null,{success:this._handleSaveSuccess,error:this._handleError})}),this.bind("remove",e=>{e.id="",e.destroy({success:this._handleDestroySuccess,error:this._handleError})}),this.currentUserName=J.a.get("remote-user")},updateLikes:function(){this.reset(g.getLikes(this.contentId))},addUser:function(e){return this.add({username:e})},removeUser:function(e){return this.remove(this.getUserByName(e))},isLikedByUser:function(e){return!!this.getUserByName(e)},getUserByName:function(e){return this.findWhere({username:e})},toggleLike:function(){this.isLikedByUser(this.currentUserName)?this.removeUser(this.currentUserName):this.addUser(this.currentUserName)},_handleSaveSuccess:function(){g.add(this.contentId,this.currentUserName)},_handleDestroySuccess:function(){g.remove(this.contentId,this.currentUserName)},_handleError:function(e,t){this.updateLikes(),405===t.status&&t.responseText?o.a.trigger("ic:error","This site is read-only. You can\u0027t make changes right now."):o.a.trigger("ic:error","Likes cannot be updated.")}});const W=({showLikeButton:e,isLikedByUser:t,likesCount:i,contentId:s})=>k.a.createElement(k.a.Fragment,null,e&&k.a.createElement(I.a,{text:t?"Unlike":"Like",type:"link",extraClasses:"ic-like-button"}),i>0&&k.a.createElement("span",{className:"ic-like-summary"},k.a.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-like"}),k.a.createElement("a",{className:"ic-likes-count","data-content-id":s},k.a.createElement("span",{className:"ic-like-summary"},i))));var Z=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/likes/likes.scss"),ee={insert:"head",singleton:!1};R()(Z.a,ee),Z.a.locals;var te=o.a.View.extend({className:"ic-likes",events:{"click .ic-like-button":"toggleLike","click .ic-likes-count":function(e){f.a.Confluence.Likes.showLikeUsers&&f.a.Confluence.Likes.showLikeUsers.apply(e.currentTarget,[e])}},initialize:function(e){this.collection=new G(null,{contentId:e.contentId}),this.listenTo(this.collection,"add remove reset",this.render),this.currentUserName=J.a.get("remote-user")||"",void 0===e.showLikeButton?this.showLikeButton=!0:this.showLikeButton=e.showLikeButton},render:function(){if(this.$el.empty(),g.isLikable()){const e=""!==this.currentUserName&&!1!==J.a.get("remote-user-has-licensed-access"),t=this.collection.length,i=this.collection.isLikedByUser(this.currentUserName);this.showLikeButton="READ_ONLY"!==J.a.get("render-mode");const n={showLikeButton:this.showLikeButton&&e,isLikedByUser:i,likesCount:t,contentId:this.collection.contentId};this.$el.html(C.a.renderToStaticMarkup(k.a.createElement(W,n)))}return this},toggleLike:function(){this.collection.toggleLike()}}),ie=i("com.atlassian.confluence.plugins.confluence-editor-plugin:core/require('tinymce')"),ne=i.n(ie);i(2),i(3);function se(){f.a.Confluence.EditorLoader.resourcesLoaded()||this.$form.find(".loading-container").spin("small")}function oe(){J.a.set("content-type","comment"),J.a.set("use-inline-tasks","false"),J.a.set("min-editor-height",80)}function ae(e){e.$form.find(".loading-container").hide(),e.$form.find("#rte-button-publish").text("Save").removeAttr("title"),e.$form.find("#toolbar-hints-draft-status").hide(),this.hideCancelButton&&e.$form.find("#rte-button-cancel").hide(),e.editor.on("PostProcess",function(e,t){const i=function(){ne.a.DOM.setStyle(ne.a.DOM.get(t.id+"_ifr"),"height","80px"),t.execCommand("mceAutoResize",{forceExec:!0}),t.off(e,i)};return i}("PostProcess",e.editor)),f.a.Confluence.Editor&&!f.a.Confluence.Editor.getContentType&&f.a.Confluence.QuickEdit.QuickEditPage.disable(),f.a.Confluence.Editor.removeAllCancelHandlers(),f.a.Confluence.Editor.removeAllSaveHandlers()}function re(){return Object(u.o)()?f.a.Confluence.QuickEdit.deactivateEditor():m.a.Deferred().resolve()}var ce=i("./src/main/frontend/model/comment.ts"),le=i("./src/main/frontend/model/reply.ts");const de=({authorUserName:e,authorAvatarUrl:t,authorDisplayName:i,type:n,darkFeatures:s,text:o,parentClassName:a="ic-comment-container"})=>k.a.createElement("div",{className:a},("topLevel"===n||"pageComment"==n)&&k.a.createElement(M,{showMenu:!1,createComment:!0,darkFeatures:s,isViewMode:!0}),k.a.createElement(me,{authorUserName:e,authorAvatarUrl:t,authorDisplayName:i,type:n,text:o||"",darkFeatures:s})),me=({authorUserName:e,authorAvatarUrl:t,authorDisplayName:i,type:s,text:o,darkFeatures:a})=>k.a.createElement("div",{className:"ic-container ic-create-comment"},k.a.createElement(P,{authorUserName:e||"",authorAvatarUrl:t||"",authorDisplayName:i||""}),k.a.createElement("div",{className:"ic-body"},k.a.createElement("form",{className:"aui",action:""},null!=a&&a.RICH_TEXT_EDITOR?k.a.createElement("div",{className:"loading-container"}):k.a.createElement(k.a.Fragment,null,(()=>{const e="reply"===s?null===n.I18n||void 0===n.I18n?void 0:"Reply":null===n.I18n||void 0===n.I18n?void 0:"write a comment...";return k.a.createElement("textarea",{className:"textarea ic-textarea",name:"body",placeholder:e,defaultValue:o})})(),k.a.createElement("div",{className:"ic-actions"},k.a.createElement("ul",null,k.a.createElement("li",null,k.a.createElement(I.a,{text:"Save",type:"link",extraClasses:"ic-action-save",isDisabled:!0})),"topLevel"===s&&k.a.createElement("li",null,k.a.createElement(I.a,{text:"Cancel",type:"link",extraClasses:"ic-action-discard"}))))))));var ue=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/create-comment/create-comment.scss"),he={insert:"head",singleton:!1};R()(ue.a,he),ue.a.locals;var pe=o.a.View.extend({tagName:"div",className:"ic-create-comment-view",events:{"click .ic-action-save":"saveComment","click .ic-action-discard":"discardComment","keyup .ic-textarea":"onInput","focus .ic-textarea":"onFocus","click #show-page-comment":"showPageComment"},template:e=>k.a.createElement(de,e),initialize:function(e){this.selection=e.selection,this.type=e.type,this.warningData=e.warningData,this.onFinished=e.onFinished||function(){},this.commentText=e.commentText||"",this.stopFocus=e.stopFocus,this.serializedHighlights=e.serializedHighlights,"edit"!==e.type&&"reply"!==e.type||(this.template=e=>k.a.createElement(me,e),o.a.trigger("ic:discard-edit"),this.listenTo(o.a,"ic:discard-edit",this.discardComment))},finish:function(){this.onFinished(),y.a.trigger("ic-jim-async-supported")},render:function(){const e=this._getAuthorObject(),t={type:this.type,text:this.commentText,showMenu:!1},i=p.a.extend({},e,t,{darkFeatures:Object(u.n)()});return this.$el.html(C.a.renderToStaticMarkup(this.template(i))),Object(u.n)().RICH_TEXT_EDITOR?this.renderEditor():this.stopFocus||setTimeout(p.a.bind(this.focusEditor,this),1),Object(u.a)(this),this},onInput:function(e){const t=""!==this.$(e.target).val().trim();this._saveDisable(!t)},onFocus:function(){if("edit"===this.type){const e=this.$(".textarea");Object(u.F)(e[0]),this._saveDisable(""===e.text())}},saveComment:function(e){e.preventDefault(),this._isValid()&&(this._disableForm(),"reply"===this.type?this._addReply():"edit"===this.type?this._saveEdit():this._addComment())},_setAriaLabelToEditor:function(){Object(u.p)().attr("aria-label",this._getAriaLabel(this.type))},_getAriaLabel:function(e){switch(e){case"topLevel":return "Add an inline comment";case"reply":return "Reply to inline comment";case"edit":return "Edit inline comment";default:return "inline.default.edit.ariaLabel"}},_getAuthorObject:function(){let e,t,i;return"edit"===this.type?(e=this.model.get("authorUserName"),t=this.model.get("authorAvatarUrl"),i=this.model.get("authorDisplayName")):(e=J.a.get("remote-user"),t=Object(u.j)(),i=Object(u.k)()),{authorUserName:e,authorAvatarUrl:t,authorDisplayName:i}},_saveEdit:function(){const e=this._getContent(),t={wait:!0,beforeSend:p.a.bind(this.beforeSendAjax,this),success:p.a.bind(this._onSaveSuccess,this),error:p.a.bind(this._showEditError,this)};this.model.save({body:e},t)},_showEditError:function(e,t){if(this.showCaptchaError(t))return;let i;switch(t.status){case 401:i="You don\u0027t have permission to edit this comment.";break;case 405:if(t.responseText){if("READ_ONLY"===JSON.parse(t.responseText).reason){i="This site is read-only. You can\u0027t make changes right now.";break}}break;case 400:if(t.responseText&&t.responseText.indexOf("Unsupported character found in content: ")>=0){const e=t.responseText.split("Unsupported character found in content: ")[1];i=n.format("We can\u0027\u0027t save your inline comment because the {0} character isn\u0027\u0027t supported by your database.\u003cbr\u003e\u003cbr\u003eRemove this character or use a Confluence symbol or emoticon instead. \u003ca href = \u0022https://confluence.atlassian.com/x/BYfsNg\u0022 target=\u0022_blank\u0022\u003eLearn more\u003c/a\u003e",e)}break;default:i="We can\u0027t save your edit. The comment might have been deleted."}this._triggerError(i,{})},_triggerError:function(e,t){o.a.trigger("ic:error",e,t),this._disableForm(!1)},_addReply:function(){new le.a({body:this._getContent(),commentId:this.model.get("id"),hasDeletePermission:!!J.a.get("remote-user")||this.model.get("hasDeletePermission")}).save(null,{beforeSend:p.a.bind(this.beforeSendAjax,this),success:p.a.bind(this._onSaveSuccess,this),error:p.a.bind((e,t)=>{if(!this.showCaptchaError(t))if(405===t.status&&t.responseText){"READ_ONLY"===JSON.parse(t.responseText).reason&&o.a.trigger("ic:error","This site is read-only. You can\u0027t make changes right now.")}else if(400===t.status&&t.responseText){const e=t.responseText.split("Unsupported character found in content: ")[1];this._triggerError(n.format("We can\u0027\u0027t save your inline comment because the {0} character isn\u0027\u0027t supported by your database.\u003cbr\u003e\u003cbr\u003eRemove this character or use a Confluence symbol or emoticon instead. \u003ca href = \u0022https://confluence.atlassian.com/x/BYfsNg\u0022 target=\u0022_blank\u0022\u003eLearn more\u003c/a\u003e",e),{})}else this._triggerError("Could not save the reply",{})},this)})},_addComment:function(){const e=new ce.a({originalSelection:this.selection.searchText.selectedText.replace(/\n/g,""),body:this._getContent(),matchIndex:this.selection.searchText.index,numMatches:this.selection.searchText.numMatches,serializedHighlights:this.serializedHighlights}),t={callback:this.bindPageReloadLink};e.save(null,{beforeSend:p.a.bind(this.beforeSendAjax,this),success:p.a.bind(this._onSaveSuccess,this),error:p.a.bind((e,i)=>{if(!this.showCaptchaError(i))switch(i.status){case 405:this._triggerError("This site is read-only. You can\u0027t make changes right now.",{});break;case 409:this._triggerError(n.format("Page content is out of date, please {0}refresh{1} and try again.",'<a href="#" class="ic-reload-page">',"</a>"),t);break;case 412:y.a.trigger("analytics",{name:"confluence.comment.inline.cannot.create"}),this._triggerError("We can\u0027t add your inline comment; the section you highlighted may contain a macro or user mention. Try highlighting plain text.",{});break;case 400:if(i.responseText&&i.responseText.indexOf("Unsupported character found in content: ")>=0){const e=i.responseText.split("Unsupported character found in content: ")[1];this._triggerError(n.format("We can\u0027\u0027t save your inline comment because the {0} character isn\u0027\u0027t supported by your database.\u003cbr\u003e\u003cbr\u003eRemove this character or use a Confluence symbol or emoticon instead. \u003ca href = \u0022https://confluence.atlassian.com/x/BYfsNg\u0022 target=\u0022_blank\u0022\u003eLearn more\u003c/a\u003e",e),{})}break;default:this._triggerError("Could not save the comment",{})}},this)})},_isValid:function(){return""!==m.a.trim(this._getContent())||(o.a.trigger("ic:error","You cannot save an empty comment."),!1)},_onSaveSuccess:function(e){switch(e.attributes.lastModificationDate=Object(u.i)(e.attributes.lastModificationDate),e.changed.lastModificationDate=Object(u.i)(e.changed.lastModificationDate),this.type){case"topLevel":e.set("hasDeletePermission",!0),o.a.trigger("ic:persist",e),o.a.trigger("ic:view",e,void 0,{ignoreConfirmDialog:!0});break;case"reply":this.model.replies.push(e),o.a.trigger("ic:reply:persist",e),this.finish();break;case"edit":o.a.trigger("ic:edit"),this.finish()}},_setEditorIsNotDirty:function(){const e=Object(u.o)();null!==e&&(e.isNotDirty=!0)},_disableForm:function(e){void 0===e&&(e=!0),this._saveDisable(e),Object(u.n)().RICH_TEXT_EDITOR||this.$(".ic-action-discard,.ic-textarea").prop("disabled",e).attr("aria-disabled",e)},_saveDisable:function(e){var t;Object(u.n)().RICH_TEXT_EDITOR?((t=e)?m()(".ic-sidebar #rte-spinner").spin():m()(".ic-sidebar #rte-spinner").spinStop(),m()("#rte-button-publish").prop("disabled",t),m()("#rte-button-cancel")[0].disabled=e):this.$(".ic-action-save").prop("disabled",e).attr("aria-disabled",e)},renderEditor:function(){const e=this.$(".ic-body"),t=this.commentText,i=f.a.Confluence.QuickEdit.QuickComment;return function(e){const{container:t,form:i,saveHandler:n,cancelHandler:s,fetchContent:o,postDeactivate:a}=e;return f.a.Confluence.QuickEdit.activateEditor({preActivate:se,preInitialise:oe,postInitialise:m.a.proxy(ae,e),toolbar:!1,$container:t,$form:i,saveHandler:n,cancelHandler:s,fetchContent:o(),closeAnyExistingEditor:!0,postDeactivate:a,plugins:Object(u.v)(),excludePlugins:Object(u.x)()})}({container:e,form:e.find("form.aui"),saveHandler:"pageComment"===this.type?i.createSaveHandler(p.a.bind(this._successCreatePageComment,this),i.saveCommentErrorHandler):p.a.bind(this.saveComment,this),cancelHandler:p.a.bind(this.discardComment,this),fetchContent:function(){const e=new m.a.Deferred;return e.resolve({editorContent:t}),e},postDeactivate:p.a.bind(()=>{o.a.trigger("ic:clearError"),this.finish()},this),hideCancelButton:"topLevel"===this.type}).done(p.a.bind(this.renderEditorCompleted,this)).fail(p.a.bind(this.renderEditorFail,this))},showPageComment:function(e){const t=m()(e.target).data("comment-id"),i=m()("#comment-"+t);i.addClass("focused"),i.scrollToElement()},_successCreatePageComment:function(e){f.a.Confluence.CommentDisplayManager.addComment(Object(u.m)(),e,!1,!1,!0),y.a.trigger("page.commentAddedOrUpdated",{commentId:e.id}),this._setEditorIsNotDirty(),Object(u.n)().RICH_TEXT_EDITOR&&(this.keepSidebar=!0,re()),this.$el.html(C.a.renderToStaticMarkup(k.a.createElement(q,{commentId:e.id}))),Object(u.a)(this)},renderEditorCompleted:function(){if(o.a.trigger("ic:clearError"),this._setAriaLabelToEditor(),"topLevel"===this.type||"pageComment"===this.type)if(this.$("#rte-button-cancel").hide(),this.warningData){switch(this.warningData.type){case"mention":o.a.trigger("ic:error","We can\u0027t add an inline comment here because the selected text includes a mention.  We\u0027ll add it as a page comment instead.");break;case"internalLink":o.a.trigger("ic:error","We can\u0027t add an inline comment because the selected text includes a relative link. We\u0027ll add it as a page comment instead.");break;case"dateLozenge":o.a.trigger("ic:error","We can\u0027t add an inline comment here because the selected text includes a date lozenge.");break;case"unsupportedMacro":{let e;f.a.MacroBrowser&&(e=f.a.MacroBrowser.getMacroMetadata(this.warningData.macro).title),e?o.a.trigger("ic:error",n.format("We can\u0027\u0027t add an inline comment because the selected text includes the {0} macro. We\u0027\u0027ll add it as a page comment instead.",e)):o.a.trigger("ic:error","We can\u0027t add an inline comment to this content. We\u0027ll add it as a page comment instead.");break}}this.focusEditor()}else"pageComment"===this.type&&(o.a.trigger("ic:error","We can\u0027t add an inline comment to this content. We\u0027ll add it as a page comment instead."),this.focusEditor());this.captchaManager=new f.a.Confluence.QuickEditCaptchaManager(f.a.Confluence.EditorLoader.getEditorForm())},renderEditorFail:function(e){const t={closeable:!0,callback:this.bindPageReloadLink};switch(this.type){case"pageComment":this._setEditorIsNotDirty();break;case"topLevel":this.$(".loading-container").hide(),this.$(".ic-create-comment").hide(),t.closeable=!1;break;case"edit":case"reply":this.finish()}let i;switch(e){case"READ_ONLY":t.closeable=!1,i="This site is read-only. You can\u0027t make changes right now.";break;default:i=n.format("The editor didn\u0027\u0027t load properly. Please {0}reload the page{1} to try again.",'<a href="#" class="ic-reload-page">',"</a>")}o.a.trigger("ic:error",i,t),o.a.trigger("ic:editor:load:fail")},bindPageReloadLink:function(){m()(".ic-error").off("click",".ic-reload-page").on("click",".ic-reload-page",(function(){return window.location.reload(),!1}))},discardComment:function(e){null==e||e.preventDefault(),o.a.trigger("ic:clearError"),this.finish()},_getContent:function(){return Object(u.n)().RICH_TEXT_EDITOR?null===(e=Object(u.o)())||void 0===e?void 0:e.getContent():this.$("textarea").val();var e},focusEditor:function(){if(Object(u.n)().RICH_TEXT_EDITOR)if("pageComment"===this.type){var e,t,i;const n=m()(null===(e=Object(u.o)())||void 0===e?void 0:e.getBody()).find("div")[0];null===(t=Object(u.o)())||void 0===t||t.selection.select(n,!0),null===(i=Object(u.o)())||void 0===i||i.selection.collapse(!0),n.focus()}else{var n;null===(n=Object(u.o)())||void 0===n||n.focus()}else this.$(".ic-textarea:visible").focus()},destroy:function(){Object(u.n)().RICH_TEXT_EDITOR&&re(),this.remove()},beforeSendAjax:function(e){const t=this.captchaManager.getCaptchaData();t&&t.id&&(e.setRequestHeader("X-Atlassian-Captcha-Id",t.id),e.setRequestHeader("X-Atlassian-Captcha-Response",t.response))},showCaptchaError:function(e){return!(404!==e.status||!e.responseText||-1==e.responseText.search(/captcha/i))&&(this.captchaManager.refreshCaptcha(),this._triggerError("The typed word did not match the text in the picture.",{}),!0)}});const ge=({authorUserName:e,authorAvatarUrl:t,authorDisplayName:i,body:n,hasDeletePermission:s,hasEditPermission:o,lastModificationDate:a,commentDateUrl:r,resolved:c,darkFeatures:l})=>k.a.createElement(k.a.Fragment,null,k.a.createElement(P,{authorUserName:e,authorAvatarUrl:t,authorDisplayName:i,lastModificationDate:a,commentDateUrl:r}),k.a.createElement("div",{className:"ic-body wiki-content"},k.a.createElement("div",{className:"ic-content ic-reply-content",dangerouslySetInnerHTML:{__html:n}})),null!=l&&l.INLINE_COMMENTS&&!c?k.a.createElement(ve,{hasDeletePermission:s,hasEditPermission:o}):k.a.createElement(k.a.Fragment,null)),ve=({hasDeletePermission:e,hasEditPermission:t})=>k.a.createElement("div",{className:"ic-actions"},k.a.createElement("ul",null,e&&k.a.createElement("li",null,k.a.createElement(I.a,{text:"Delete",type:"link",extraClasses:"ic-action-delete-reply"})),t&&!Object(u.B)()&&k.a.createElement("li",null,k.a.createElement(I.a,{text:"Edit",type:"link",extraClasses:"ic-action-edit-reply"})),k.a.createElement("li",{className:"ic-action-like-reply"}))),fe=({totalReplies:e})=>k.a.createElement("div",{id:"ic-showmore-container"},k.a.createElement("div",{className:"ic-decor-line"}),k.a.createElement("div",{className:"ic-decor-line"}),k.a.createElement("div",{className:"ic-collapse-decor-center"},k.a.createElement("span",null,n.format("{0} more replies",e))));var be=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/display-reply/display-reply.scss"),ye={insert:"head",singleton:!1};R()(be.a,ye),be.a.locals;var we=o.a.View.extend({tagName:"div",className:"ic-display-reply",template:e=>k.a.createElement(ge,e),events:{"click .ic-action-edit-reply":"editReply","click .ic-action-delete-reply":"confirmDelete"},initialize:function(){p.a.bindAll(this,"onEditCallback"),this.$el.attr("data-comment-id",this.model.get("id"))},render:function(){const e=p.a.extend(this.model.toJSON(),{resolved:this.options.resolved,darkFeatures:Object(u.n)()});"READ_ONLY"===J.a.get("render-mode")&&(e.hasEditPermission=!1,e.hasDeletePermission=!1);const t=this.template(e);return this.$el.html(C.a.renderToStaticMarkup(t)),this._renderLikes(),this.$el[0].querySelectorAll(".comment-permalink").forEach(e=>Object(w.initCommentPermalinkButton)(m()(e),"inlinecomment")),this},_renderLikes:function(){this.likesView&&this.likesView.remove(),this.likesView=new te({contentId:this.model.id}).render(),this.likesView.$el.is(":empty")?this.$(".ic-action-like-reply").remove():this.$(".ic-action-like-reply").html(this.likesView.el)},editReply:function(e){if(Object(u.c)()){Object(u.r)(this.model.get("id")).done(e=>{this.editView=new pe({model:this.model,type:"edit",selection:{},onFinished:this.onEditCallback,commentText:e}),this.$el.html(this.editView.$el),this.editView.render()}).fail((function(){o.a.trigger("ic:error","We can\u0027t edit this reply. The reply might have been deleted.")}))}else{var t,i;null==e||null===(t=e.currentTarget)||void 0===t||null===(i=t.blur)||void 0===i||i.call(t)}},onEditCallback:function(){this.editView&&this.editView.destroy(),this.editView=null,this.render()},deleteFail:function(e,t){switch(t.status){case 401:o.a.trigger("ic:error","You don\u0027t have permission to delete this comment.");break;case 405:if(t.responseText){if("READ_ONLY"===JSON.parse(t.responseText).reason){o.a.trigger("ic:error","This site is read-only. You can\u0027t make changes right now.");break}}break;default:o.a.trigger("ic:error","Could not complete your request.")}},confirmDelete:function(e){!0===window.confirm("Are you sure you want to delete this reply?")&&this.deleteReply(e),e.preventDefault()},deleteReply:function(e){m()(e.target).attr("aria-disabled",!0).prop("disabled",!0),this.model.destroy({wait:!0,error:this.deleteFail,success:function(){o.a.trigger("ic:reply:delete")}})},destroy:function(){this.likesView&&this.likesView.remove(),this.editView&&this.editView.destroy(),this.remove()}});var xe=o.a.View.extend({tagName:"div",className:"ic-replies",events:{"click #ic-showmore-container":"forceShowAllReplies"},initialize:function(e){if(!e.commentModel)throw new Error("Inline Comment Model should be passed as a parameter when init ReplyListView","ReplyListView");this.replyViews=[],this.collection=e.commentModel.replies,this.source=e.source,this.listenTo(this.collection,"add remove",this.render),!0!==this.collection.isFetched&&(this.listenToOnce(this.collection,"sync",this.fetchComplete),this.collection.fetch({reset:!0})),this.expandReplies=!1,this.COMMENT_NUMBER_TO_COLLAPSE=4},fetchComplete:function(){this.collection.isFetched=!0,this.render(),Object(u.J)(this.$el)},render:function(e){return!0!==this.collection.isFetched?this:e&&this.collection.last()===e?void this.appendReply(e):(this.cleanUpReplyViews(),this.$el.empty(),this.collection.length>this.COMMENT_NUMBER_TO_COLLAPSE&&!1===this.expandReplies&&"permalink"!==this.source&&this.options.commentModel&&!this.options.commentModel.isResolved()?this.renderCollapsibleReplies():this.renderFullReplies(),this.trigger("ic:reply-rendered",this.options.commentModel),this._hightlightReply(),y.a.trigger("ic-jim-async-supported"),this)},renderFullReplies:function(){this.collection.each(e=>{this.appendReply(e)},this)},forceShowAllReplies:function(){this.expandReplies=!0,this.render()},renderCollapsibleReplies:function(){this.renderExpendButton();const e=this.collection.last();this.appendReply(e)},appendReply:function(e){const t=this.createReplyView(e);this.replyViews.push(t),this.$el.append(t.render().el)},renderExpendButton:function(){this.$el.append(C.a.renderToStaticMarkup(k.a.createElement(fe,{totalReplies:this.collection.length-1})))},createReplyView:function(e){return new we({model:e,resolved:this.options.commentModel.isResolved()})},_hightlightReply:function(){if("permalink"!==this.source)return;const e=window.location.search.match(/(focusedCommentId|replyToComment)=(\d+)/);if(null==e)return;const t=parseInt(e[2],10);t&&0!==t&&this.$(`[data-comment-id=${t}]`).addClass("ic-comment-reply-highlight")},cleanUpReplyViews:function(){for(let e=0;e<this.replyViews.length;e++)this.replyViews[e].destroy(),this.replyViews[e]=null;this.replyViews=[]},destroy:function(){this.cleanUpReplyViews(),this.remove()}}),ke=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/resolved-comment/resolved-comment.scss"),Ee={insert:"head",singleton:!1};R()(ke.a,Ee),ke.a.locals;var Ce=o.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:e=>k.a.createElement(Y,e),events:{"click .ic-action-unresolve":"unresolveComment","click .ic-action-show-reply":"showReply"},initialize:function(){p.a.bindAll(this,"onUnresolveComplete","destroy"),this.replyListView=new xe({commentModel:this.model}),this.listenTo(this.replyListView,"ic:reply-rendered",()=>{this.renderNumberOfReplies()})},render:function(){const e=this.template(p.a.extend(this.model.toJSON(),{showMenu:!1,isDangling:this.model.isDangling(),darkFeatures:Object(u.n)(),hasReply:this.model.replies.length>0}));return this.$el.html(C.a.renderToStaticMarkup(e)),this.likesView&&this.likesView.remove(),this.likesView=new te({contentId:this.model.id,showLikeButton:!1}).render(),this.$(".ic-action-like").html(this.likesView.el),this.$el.append(this.replyListView.$el.hide()),this.replyListView.render(),this.$el[0].querySelectorAll(".comment-permalink").forEach(e=>Object(w.initCommentPermalinkButton)(m()(e),"inlinecomment")),this},unresolveComment:function(){o.a.trigger("ic:resolvedClearError"),this.model.resolve(!1,{wait:!0,success:this.onUnresolveComplete,error:this.onUnresolveFail})},onUnresolveComplete:function(){o.a.trigger("ic:unresolved"),this.$el.slideUp(this.destroy)},onUnresolveFail:function(e,t){switch(t.status){case 401:o.a.trigger("ic:resolvedError","You don\u0027t have permission to resolve this comment.");break;case 405:"READ_ONLY"===JSON.parse(t.responseText).reason?o.a.trigger("ic:resolvedError","This site is read-only. You can\u0027t make changes right now."):o.a.trigger("ic:resolvedError","Could not complete your request.");break;default:o.a.trigger("ic:resolvedError","Could not complete your request.")}},showReply:function(){this.$(".ic-action-show-reply").parent().remove(),this.$(".ic-replies").slideDown()},renderNumberOfReplies:function(){const e=this.model.replies.length,t=this.$(".ic-action-show-reply");if(e>0){let i;i=1===e?n.format("{0} reply",1):n.format("{0} replies",e),t.text(i),t.parent().removeClass("hidden")}else t.parent().remove()},destroy:function(){this.replyListView.destroy(),this.remove()}});const Te=({layer:e})=>k.a.createElement(I.b,{id:"ic-resolved-comment-dialog",removeOnHide:!0,extraClasses:"ic-resolved-comment-dialog-content",modal:!0,titleText:"Resolved comments",footerActionContent:k.a.createElement(I.a,{id:"resolved-dialog-close-button",text:"Close",type:"link"}),content:k.a.createElement("div",{id:"ic-resolved-comment-dialog-error"}),layer:e}),Oe=()=>k.a.createElement(k.a.Fragment,null,k.a.createElement("p",null,"Got more to say? You can reopen resolved comments to continue the discussion."),k.a.createElement(I.a,{id:"ic-resolved-discovery-dismiss",type:"link",text:"OK, got it"}));var je=o.a.View.extend({events:{"click #resolved-dialog-close-button":"destroy"},template:e=>k.a.createElement(Te,e),initialize:function(){p.a.bindAll(this,"render","destroy","_onKeyDown"),this._resolvedCommentViews=[],this.listenTo(this.collection,"change:resolveProperties",this.onResolvedChanged),this.listenTo(o.a,"ic:resolvedError",this.displayError),this.listenTo(o.a,"ic:resolvedClearError",this.clearErrors);const e=this.template(),t=m()(C.a.renderToStaticMarkup(e));this.setElement(t),this.dialog=f.a.dialog2(this.$el),m()(document).bind("keydown",this._onKeyDown),y.a.trigger("remove-bindings.keyboardshortcuts")},render:function(){const e=m()("<div>"),t=this.collection.getResolvedCount();return 0!==t?p.a.each(this.collection.getResolvedCommentsDesc(),t=>{const i=new Ce({model:t});this._resolvedCommentViews.push(i),e.append(i.render().$el)},this):this.displayNoCommentMessage(),this.$(".aui-dialog2-content").append(e),this.dialog.show(),this.options.focusCommentId&&this.scrollToComment(this.options.focusCommentId),o.a.trigger("ic:resolved:view",t),y.a.trigger("ic-jim-async-supported"),this.$el[0].querySelectorAll(".comment-permalink").forEach(e=>Object(w.initCommentPermalinkButton)(m()(e),"inlinecomment")),this},onResolvedChanged:function(){0===this.collection.getResolvedCount()&&this.displayNoCommentMessage()},displayNoCommentMessage:function(){f.a.messages.generic(this.$(".aui-dialog2-content"),{body:"There are no resolved comments on this page.",closeable:!1})},displayError:function(e){this.clearErrors(),f.a.messages.error(this.$("#ic-resolved-comment-dialog-error"),{body:e,closeable:!1})},clearErrors:function(){this.$("#ic-resolved-comment-dialog-error").empty()},scrollToComment:function(e){const t=this.$(f.a.format("[data-comment-id={0}]",e));if(t.length)return t.addClass("focused"),this.$(".aui-dialog2-content").animate({scrollTop:t.parent().position().top},100);return(new(m.a.Deferred())).reject()},_onKeyDown:function(e){this.$el&&this.$el.is(":visible")&&e.keyCode===f.a.keyCode.ESCAPE&&this.destroy()},destroy:function(){y.a.trigger("add-bindings.keyboardshortcuts"),m()(document).unbind("keydown",this._onKeyDown),this.dialog.hide(),this.dialog.remove(),p.a.each(this._resolvedCommentViews,(function(e){e.destroy()})),this._resolvedCommentViews=null,this.remove()}}),Ie=i("confluence.web.components:core/require('confluence/hover-user')"),Ne=i.n(Ie);function _e(){return ne.a.activeEditor}var De=i("./src/main/frontend/loader/context/editor/index.ts");const Re={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;","`":"&#96;"},Ve=new RegExp(`[${Object.keys(Re).join("")}]`,"g");i(4);var Se=i("./src/main/frontend/loader/context/editor/cursorHandler.ts"),Le=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/confirm-dialog/confirm-dialog.scss"),Ae={insert:"head",singleton:!1};R()(Le.a,Ae),Le.a.locals;const Me=({label:e,message:t})=>k.a.createElement(k.a.Fragment,null,k.a.createElement("strong",{className:"ic-confirm-label"},e),k.a.createElement("div",{className:"ic-confirm-message"},t),k.a.createElement("div",{className:"ic-confirm-buttons"},k.a.createElement(I.a,{text:"Delete",extraClasses:["ic-action-delete-confirm","aui-button-compact"]}),k.a.createElement(I.a,{text:"Cancel",type:"link",extraClasses:["ic-action-cancel-confirm","aui-button-compact"]})));var Pe=o.a.View.extend({tagName:"div",className:"ic-confirm-container",initialize:function(e){this.$menuEl=e.$menuEl,this.$bodyEl=e.$bodyEl,this.$menuEl.addClass("ic-action-menu-active"),this.render(),p.a.bindAll(this,"clickOutside"),this.$bodyEl.on("click",this.clickOutside)},events:{"click .ic-action-cancel-confirm":"cancel","click .ic-action-delete-confirm":"confirm"},template:e=>k.a.createElement(Me,e),render:function(){return this.$el.html(C.a.renderToStaticMarkup(this.template(this.model.toJSON()))),this},clickOutside:function(e){m.a.contains(this.el,e.target)||this.el===e.target||this.cancel()},cancel:function(){this.destroy()},confirm:function(){this.trigger("ic:confirm"),this.destroy()},destroy:function(){this.$bodyEl.off("click",this.clickOutside),this.$menuEl.removeClass("ic-action-menu-active"),this.remove()}}),$e=i("./src/main/frontend/model/comment-collection.ts"),Ue=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/navigation/navigation.scss"),Fe={insert:"head",singleton:!1};R()(Ue.a,Fe),Ue.a.locals;var Be=o.a.View.extend({tagName:"div",events:{"click #ic-nav-previous":"showPrevious","click #ic-nav-next":"showNext"},template:e=>k.a.createElement(_,e),initialize:function(){this.model.collection||(this.model.collection=$e.a),this.collection=this.model.collection,this.listenTo(this.collection,"change:resolveProperties",this.onResolveToggle),this.disabled=this.collection.getCommentsOnPageCount()<=1,this.isViewMode=!Object(u.B)(),this.isMacOS=Object(u.D)(),this.listenTo(o.a,"ic:show-previous",this.showPrevious),this.listenTo(o.a,"ic:show-next",this.showNext)},render:function(){return this.$el.html(C.a.renderToStaticMarkup(this.template({disabled:this.disabled,showIndex:!(this.model.isResolved()||this.model.get("deleted")),index:this.collection.getActiveIndexWithinPageComments()+1,size:this.collection.getCommentsOnPageCount(),isViewMode:this.isViewMode,isMacOS:this.isMacOS}))),this},onResolveToggle:function(){this.disabled=this.collection.getCommentsOnPageCount()<=1,this.render()},showPrevious:function(){if(this.disabled)return;const e=this.collection.getPrevCommentOnPage();null!=e&&o.a.trigger("ic:view",e,"nav")},showNext:function(){if(this.disabled)return;const e=this.collection.getNextCommentOnPage();null!=e&&o.a.trigger("ic:view",e,"nav")}});var qe=o.a.View.extend({DIALOG_BACKGROUND_COLOR:"var(--ds-surface, #fff)",DIALOG_BORDER_COLOR:"var(--ds-border-accent-orange, #f79232)",initialize:function(){p.a.bindAll(this,"getDiscoveryDialogContent","destroy","onEndScroll")},template:e=>k.a.createElement(Oe,e),show:function(){m.a.when(this.scrollTop()).done(this.onEndScroll)},onEndScroll:function(){this.showToolsMenu(),this._discoveryDialog=this.createDiscoveryDialog(),this._discoveryDialog.show()},showToolsMenu:function(){const e=m()("#action-menu");e.on("aui-dropdown2-hide",this.destroy),m()("#action-menu-link").trigger("aui-button-invoke"),e.find("a.active").removeClass("active");const t=e.find("#view-resolved-comments").addClass("active");setTimeout((function(){t.focus()}))},createDiscoveryDialog:function(){const e={gravity:"w",hideCallback:this.destroy,width:280,noBind:!0},t=f.a.InlineDialog(m()("#view-resolved-comments"),"ic-resolved-dialog-discovery",this.getDiscoveryDialogContent,e);return t.on("click focusin mousedown",(function(e){e.stopPropagation()})),t},getDiscoveryDialogContent:function(e,t,i){const n=this.template();return e.html(C.a.renderToStaticMarkup(n)),e.find("#ic-resolved-discovery-dismiss").on("click",()=>{o.a.trigger("ic:resolved:dismiss:recovery"),this._discoveryDialog.hide()}),i(),!1},scrollTop:function(){const e=m()("#splitter-content"),t=!!e.length?e:m()("html, body"),i=0===t.scrollTop()?1:300;return t.animate({scrollTop:0},i)},destroy:function(){const e=m()("#action-menu");e.off("aui-dropdown2-hide"),e.is(":visible")&&m()("#action-menu-link").trigger("aui-button-invoke"),this._discoveryDialog.remove(),this.remove()}}),ze=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/display-comment/display-comment.scss"),He={insert:"head",singleton:!1};R()(ze.a,He),ze.a.locals;var Ye=o.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:e=>k.a.createElement(U,e),events:{"click .ic-action-reply":"replyComment","click .ic-action-resolve":"resolveComment","click .ic-action-edit":"editComment","click .ic-action-delete":"confirm","click #show-resolved-comments":"showResolvedDialogDiscovery","click .ic-reply-placeholder .textarea":"replyComment","focus .ic-reply-container .textarea":"onReplyPlaceholderFocus","keyup .ic-reply-container .textarea":"onReplyPlaceholderType"},initialize:function(e){if(p.a.bindAll(this,"confirm","destroy","deleteFail","replyComment","resolveComment","editComment","renderCommentOnly"),this.model.set("active",!0),this.listenTo(this.model,"change:resolveProperties",this.render),parseInt(f.a.version)<9){const e=m()("body");e.on("click",".ic-action-delete a",this.confirm),e.on("click",".ic-action-reply a",this.replyComment),e.on("click",".ic-action-resolve a",this.resolveComment),e.on("click",".ic-action-edit a",this.editComment)}this.replyListView=new xe({commentModel:this.model,source:e.source})},render:function(){const e=p.a.extend(this.model.toJSON(),{showMenu:"READ_WRITE"===J.a.get("render-mode")&&!Object(u.B)(),currentAuthorUserName:J.a.get("remote-user"),currentAuthorAvatarUrl:Object(u.j)(),currentAuthorDisplayName:Object(u.k)(),darkFeatures:Object(u.n)()});return Object(u.B)()&&(e.hasEditPermission=!1,e.hasReplyPermission=!1),this.$el.html(C.a.renderToStaticMarkup(this.template(e))),this.model.isResolved()?this.$(".ic-comment-container").addClass("ic-resolved"):this.$(".ic-list").append(this.replyListView.render().el),this._renderNavigation(),this._renderLikes(),Object(u.a)(this),this.$el[0].querySelectorAll(".comment-permalink").forEach(e=>Object(w.initCommentPermalinkButton)(m()(e),"inlinecomment")),this},_renderNavigation:function(){this.navigationView&&this.navigationView.remove(),this.navigationView=new Be({model:this.model}),this.navigationView.render(),this.$("#ic-nav-container").html(this.navigationView.el)},_renderLikes:function(){this.likesView&&this.likesView.remove(),this.likesView=new te({contentId:this.model.id}).render(),this.likesView.$el.is(":empty")?this.$(".ic-action-like").remove():this.$(".ic-action-like").html(this.likesView.el)},editComment:function(e){if(e.preventDefault(),this.editView)this.editView.focusEditor();else if(Object(u.c)()){Object(u.r)(this.model.get("id")).done(e=>{this.editView=new pe({model:this.model,type:"edit",selection:{},onFinished:this.renderCommentOnly,commentText:e}),this.$(".ic-display-comment").html(this.editView.$el),this.editView.render()}).fail(()=>{o.a.trigger("ic:error","We can\u0027t edit this comment. The comment might have been deleted.")})}},renderCommentOnly:function(){this.editView&&this.editView.destroy(),this.editView=null;const e=p.a.extend(this.model.toJSON(),{darkFeatures:Object(u.n)()});this.$(".ic-display-comment").html(m()(C.a.renderToStaticMarkup(k.a.createElement(Y,e))).children()),this.$el[0].querySelectorAll(".comment-permalink").forEach(e=>Object(w.initCommentPermalinkButton)(m()(e),"inlinecomment")),this._renderLikes()},replyComment:function(e){var t,i;(e&&e.preventDefault(),this.createReplyView)?this.createReplyView.focusEditor():Object(u.c)()?(this.createReplyView=new pe({model:this.model,type:"reply",onFinished:p.a.bind(()=>{this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null},this)}),this.$(".ic-reply-container").prepend(this.createReplyView.$el),this.createReplyView.render()):null==e||null===(t=e.currentTarget)||void 0===t||null===(i=t.blur)||void 0===i||i.call(t)},confirm:function(e){if(e.preventDefault(),e.stopImmediatePropagation(),this.model.replies.length>0)return o.a.trigger("ic:error","You can\u0027t delete inline comment threads with replies."),!1;const t=new Pe({model:new o.a.Model({label:"Delete",message:"Are you sure you want to delete the comment?"}),$menuEl:m()(".ic-action-menu"),$bodyEl:m()("body")});this.$(".ic-sidebar-heading").append(t.$el),this.listenTo(t,"ic:confirm",this.deleteComment),Object(u.B)()&&Object(u.K)()},deleteComment:function(){const e=p.a.bind(()=>{var e;this.$el.html(C.a.renderToStaticMarkup(k.a.createElement(F,null))),this.model.set("deleted",!0),this._renderNavigation(),Object(u.I)(this.model.highlights),Object(u.a)(this),o.a.trigger("ic:delete"),Object(u.B)()&&(this.model.set("active",!1),this.model.set("editorActive",!0)),Object(Se.b)(),null===(e=Object(u.o)())||void 0===e||e.focus()},this);this.model.destroy({wait:!0,success:e,error:this.deleteFail})},deleteFail:function(e,t){var i;switch(t.status){case 401:o.a.trigger("ic:error","You don\u0027t have permission to delete this comment.");break;case 405:if(t.responseText){"READ_ONLY"===JSON.parse(t.responseText).reason&&o.a.trigger("ic:error","This site is read-only. You can\u0027t make changes right now.")}else o.a.trigger("ic:error","Could not complete your request.");break;case 409:o.a.trigger("ic:error",t.responseText);break;default:o.a.trigger("ic:error","Could not complete your request.")}null===(i=Object(u.o)())||void 0===i||i.focus()},destroy:function(e){if(parseInt(f.a.version)<9){const e=m()("body");e.off("click",".ic-action-delete a",this.confirm),e.off("click",".ic-action-reply a",this.replyComment),e.off("click",".ic-action-resolve a",this.resolveComment),e.off("click",".ic-action-edit a",this.editComment)}this.createReplyView&&this.createReplyView.destroy(),this.editView&&this.editView.destroy(),this.replyListView.destroy(),this.navigationView&&this.navigationView.remove(),this.likesView&&this.likesView.remove(),!e&&this.remove()},resolveComment:function(e){null==e||e.preventDefault(),Object(u.c)(!0)&&this.model.resolve(!0,{wait:!0,success:p.a.bind(this.onResolveComplete,this),error:this.onResolveFail})},onResolveComplete:function(){var e;this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null,o.a.trigger("ic:resolved"),Object(u.I)(this.model.highlights);const t=Object(u.o)();t?t.focus():null===(e=m()(".ic-resolved-mask"))||void 0===e||e.attr("tabindex","-1").focus()},onResolveFail:function(e,t){var i;switch(t.status){case 401:o.a.trigger("ic:error","You don\u0027t have permission to resolve this comment.");break;case 405:if(t.responseText){"READ_ONLY"===JSON.parse(t.responseText).reason&&o.a.trigger("ic:error","This site is read-only. You can\u0027t make changes right now.")}break;default:o.a.trigger("ic:error","Could not complete your request.")}null===(i=Object(u.o)())||void 0===i||i.focus()},showResolvedDialogDiscovery:function(){(new qe).show(),o.a.trigger("ic:resolved:show:recovery")},onReplyPlaceholderFocus:function(e){if(Object(u.n)().RICH_TEXT_EDITOR){var t,i;const n=-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome");("READ_ONLY"===J.a.get("access-mode")||n)&&(null==e||null===(t=e.currentTarget)||void 0===t||null===(i=t.blur)||void 0===i||i.call(t))}},onReplyPlaceholderType:function(e){if("READ_ONLY"===J.a.get("access-mode")){const t=m()(e.currentTarget);t.val(""),t.blur()}}}),Xe=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/sidebar/sidebar.scss"),Qe={insert:"head",singleton:!1};R()(Xe.a,Qe),Xe.a.locals;var Je=o.a.View.extend({tagName:"div",className:"ic-sidebar",events:{"click button.ic-action-hide":function(e){this.hide(e,!0),o.a.trigger("ic:sidebar:close")},wheel:function(e){var t,i,n;Object(u.B)()&&(null===(t=_e())||void 0===t||null===(t=t.getWin())||void 0===t||t.scrollTo((null===(i=_e())||void 0===i||null===(i=i.getWin())||void 0===i?void 0:i.scrollX)+e.originalEvent.deltaX,(null===(n=_e())||void 0===n||null===(n=n.getWin())||void 0===n?void 0:n.scrollY)+e.originalEvent.deltaY))}},initialize:function(e){this.listenTo(o.a,"ic:view ic:overlap",this.displayComment),this.listenTo(o.a,"ic:create",this.displayCreateComment),this.listenTo(o.a,"ic:error",this.displayError),this.listenTo(o.a,"ic:hide-sidebar",this.hide),this.listenTo(o.a,"ic:clearError",this.clearError),Object(u.n)().RICH_TEXT_EDITOR?y.a.bind("rte-quick-edit-ready",()=>{const e=this.$el.find("#wysiwygTextarea_ifr");if(0!==e.length){var t;new MutationObserver((function(){e.resize()})).observe(e[0],{attributes:!0,attributeFilter:["style"]}),null!==(t=_e())&&void 0!==t&&t.getContent()||this._scrollToEditorView(e)}else{this.$el.is(":visible")||(Object(u.t)(Object(u.B)()).css("padding-right","0"),this.$wikiContent.css("position","static"),Object(u.t)(Object(u.B)()).css({"min-height":0}))}}):y.a.bind("init.rte",p.a.bind(this.hideInEditMode,this)),this.defaultNavOffset=130,this.defaultPermalinkedCommentOffset=100,this.$wikiContent=e.$wikiContent||m()("#content .wiki-content").first(),this.sidebarObserver=new MutationObserver(p.a.bind(this.setSidebarYPos,this)),this.sidebarObserver.observe(this.el,{childList:!0,subtree:!0}),m()(window).resize(p.a.debounce(p.a.bind(this.setSidebarYPos,this),100)),y.a.bind("sidebar.expanded sidebar.collapsed",p.a.debounce(p.a.bind(this.setSidebarYPos,this),50))},displayComment:function(e,t,i){const n=function(){if(e.highlight.is(":hidden")&&(Object(u.O)(e.highlight),e.highlight.is(":hidden")))return;this.distanceToTop=this.previousHighlightOffset||this.defaultNavOffset,this._emptySidebar(!0),this.commentView=new Ye({model:e,source:t}),this.show(!0);let n=e.highlight;for(this.previousHighlightOffset=n.position().top;n.offsetParent().hasClass("conf-macro output-block");)n=n.offsetParent(),this.previousHighlightOffset+=n.position().top;const s=this.commentView.render().$el;s.css("visibility","hidden"),"nav"===t?Object(u.B)()?Object(u.K)():this._scrollToComment(e):"permalink"===t?this._scrollToPermalinkedComment(e,this.defaultPermalinkedCommentOffset,i):"quickreload"===t&&this._scrollToQuickReloadComment(e),this.$el.html(s),Ne()()};void 0===i||!1===i.ignoreConfirmDialog?Object(u.c)(!0)&&n.call(this):n.call(this),y.a.trigger("ic-jim-async-supported")},_scrollToQuickReloadComment:function(e){const t=m()(".qr-feedback:first");let i=this.defaultPermalinkedCommentOffset;t.length>0&&(i=t.height()+67),this._scrollToPermalinkedComment(e,i)},_scrollToEditorView:function(e){const t=Object(u.A)()?Object(u.u)():m()("body, html"),i=this.$(".ic-display-comment-view").position().top,n=e.closest(".ic-create-comment-view").position().top+i;((null==t?void 0:t.height())<n||(null==t?void 0:t.scrollTop())>n)&&t.animate({scrollTop:n},100)},_scrollToPermalinkedComment:function(e,t,i){let n;if(Object(u.A)()){const s=40;n=e.highlight.offset().top+Object(u.u)().scrollTop()-s,Object(u.u)().animate({scrollTop:n-t},100).promise().done(p.a.bind(this._scrollToPermalinkedCommentCompleted,this,i))}else n=e.highlight.offset().top,m()("html, body").animate({scrollTop:n-t},100).promise().done(p.a.bind(this._scrollToPermalinkedCommentCompleted,this,i))},_scrollToPermalinkedCommentCompleted:function(e){e&&e.isReplyComment&&this.commentView.replyComment()},_scrollToComment:function(e){let t=e.highlight,i=t.position().top;for(;t.offsetParent().hasClass("conf-macro output-block");)t=t.offsetParent(),i+=t.position().top;Object(u.A)()?Object(u.u)().animate({scrollTop:Object(u.u)().scrollTop()+i-this.distanceToTop},100):m()("html, body").animate({scrollTop:t.offset().top-this.defaultNavOffset},100)},displayCreateComment:function(e,t,i){const n=this.warningData(),s=null===n;var o;this._emptySidebar(!0),this.createCommentView=new pe({collection:e,selection:t,type:s?"topLevel":"pageComment",warningData:n,isFocus:!1,stopFocus:!0,commentText:s?"":"<blockquote>"+(o=t.text,o.replace(Ve,e=>Re[e])+"</blockquote> <div></div>"),onFinished:()=>{this.createCommentView.keepSidebar||this.isShowing&&this.hide()},serializedHighlights:i}),this.show(),this.createCommentView.$el.css("visibility","hidden"),this.$el.html(this.createCommentView.$el),this.createCommentView.render()},warningData:function(){const e=m()(".ic-current-selection"),t=Object(u.g)(e);return t?{type:"unsupportedMacro",macro:t}:Object(u.f)(e)?{type:"internalLink"}:Object(u.h)(e)?{type:"mention"}:Object(u.d)(e)?{type:"dateLozenge"}:null},displayError:function(e,t){t=p.a.extend({closeable:!1},t),this.clearError(),function(e,t){window.AJS.messages.error(".ic-error",{body:e,closeable:t})}(e,t.closeable),t.callback&&t.callback()},clearError:function(){m()(".ic-error").empty()},show:function(e){this.isShowing||(this._toggleSidebar(e),this.isShowing=!0)},hideInEditMode:function(e){"comment"!==J.a.get("content-type")&&(this.sidebarObserver.disconnect(),this.hide(e))},hide:function(e,t){if(null==e||e.preventDefault(),Object(u.c)(!0)){var i;if(!this.isShowing){var n,s;const t=null==e?void 0:e.currentTarget;return void(null!=t&&null!==(n=t.classList)&&void 0!==n&&n.contains("active")&&(null==t||null===(s=t.classList)||void 0===s||s.remove("active")))}Object(u.t)(Object(u.B)()).css({"min-height":"initial"}),this._toggleSidebar(!Object(u.B)()&&t),o.a.trigger("ic:sidebar-hidden"),this.isShowing=!1,null===(i=Object(u.o)())||void 0===i||i.focus()}},_toggleSidebar:function(e){const t=m()(".inline-comment-marker.active:first, .ic-current-selection:first");let i;const n=Object(u.A)()?Object(u.u)().scrollTop():window.pageYOffset;var s;t.length>0&&(i=((null===(s=t.offset())||void 0===s?void 0:s.top)||0)-(n||0));const o=m.a.Deferred();let a=o.promise();this.isShowing?e&&Object(u.z)()?a=Object(u.b)(this,!1):(Object(u.t)(Object(u.B)()).css("padding-right","0"),this.$wikiContent.css("position","static"),this._emptySidebar(),o.resolve()):(Object(u.t)(Object(u.B)()).css("padding-right","280px"),e&&Object(u.z)()?a=Object(u.b)(this,!0):o.resolve(),this.$wikiContent.css("position","relative")),a.done((function(){Object(u.B)()||Object(u.L)(i,t)}))},_emptySidebar:function(e){this.commentView&&(this.commentView.model.unset&&this.commentView.model.unset("active"),this.commentView.destroy(),this.commentView=null),this.createCommentView&&(this.createCommentView.keepSidebar=e,this.createCommentView.destroy(),this.createCommentView=null)},setSidebarYPos:function(){if(!this.isShowing)return;const e=this.$el.offset().top;let t,i;if(null!=this.commentView)t=this.commentView.$el,i=this.commentView.model.highlight;else{if(null==this.createCommentView)return;t=this.createCommentView.$el,i=m()(".ic-current-selection")}if(!i)return;const n=i.offset().top+(Object(u.B)()?Object(u.w)():-e)+"px",s={visibility:"visible",position:"absolute",top:n};var o;(Object(u.B)()&&(s.right="20px",s.borderRight="1px solid var(--ds-border, #ccc)"),t.css(s),Object(u.B)())?(Object(De.setOriginalPos)(n),null===(o=Object(u.H)(t))||void 0===o||o.then(e=>{Object(u.P)(n),e&&Object(u.K)()})):Object(u.H)(t)}}),Ke=i("./src/main/frontend/loader/highlightTextView.ts");i(0),i(5);let Ge,We;const Ze={init:function(e){var t;Ge=e,We&&o.a.trigger("ic:hide-sidebar"),We=new Je({$wikiContent:Object(u.l)()}),Object(u.t)().append(We.$el),null===(t=Ge)||void 0===t||t.reInitHighlights(),Object(Ke.b)(Ge),Object(u.E)()||g.isLikable()||l.a&&l.a.Likes&&l.a.Likes.getLikesCache&&l.a.Likes.getLikesCache().done((function(e){g.init(e),o.a.trigger("ic:likes-received")})),Object(u.n)().INLINE_COMMENTS},loadSidebarOnClick:function(e){if(Object(u.c)()){o.a.trigger("ic:highlight-panel-click"),m()(".inline-comment-marker").removeClass("active");const t=Object(u.G)(e,Ge);if(t){const e=m()('.inline-comment-marker[data-ref="'+t.get("markerRef")+'"]');l.a.HighlightAction.clearTextSelection(),t.highlight=e,o.a.trigger("ic:overlap",t)}else{const t=(new r.a).removeHighlight().highlight(e.range);o.a.trigger("ic:create",Ge,e,t)}}},updateResolvedCommentCountInToolsMenu:function(){var e;m()("#view-resolved-comments>span").text("Resolved comments"+` (${null===(e=Ge)||void 0===e?void 0:e.getResolvedCount()})`)},afterSyncCommentCollection:function(){var e,t;null===(e=Ge)||void 0===e||e.once("sync",e=>{this.displayPermalinkedComment(e)}),null===(t=Ge)||void 0===t||t.on("change:resolveProperties",()=>{this.updateResolvedCommentCountInToolsMenu()}),this.updateResolvedCommentCountInToolsMenu()},displayPermalinkedComment:function(e){const t=window.location.search;Object(u.N)(e,t,je)},createResolvedCommentListView:function(){new je({collection:Ge}).render()}};t.default=Ze},2:function(e,t,i){e.exports=void 0},3:function(e,t,i){e.exports=void 0},4:function(e,t,i){e.exports=void 0},5:function(e,t,i){e.exports=void 0},"confluence.web.components:core/require('confluence/hover-user')":function(e,t){e.exports=require("confluence/hover-user")},"confluence.web.resources:view-comment/require('confluence/comments')":function(e,t){e.exports=require("confluence/comments")}}]);
}catch(e){WRMCB(e)};